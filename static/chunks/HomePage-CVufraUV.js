var K=Object.defineProperty;var Q=(a,t,o)=>t in a?K(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;var F=(a,t,o)=>Q(a,typeof t!="symbol"?t+"":t,o);import{d as x,c as v,o as _,a as h,b as X,e as Z,r as O,f as z,s as V,u as tt,g as et,h as r,i as C,w as e,j as n,k as nt,l as g,t as I,m as c,F as U,n as G,_ as H,p as J,q as st,v as ot,x as at,y as rt,z as lt}from"../dashboard.js";import{a as ct}from"./index-R-lXtGyY.js";const it={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ut=h("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M416 128L192 384l-96-96"},null,-1),dt=[ut],_t=x({name:"CheckmarkOutline",render:function(t,o){return _(),v("svg",it,dt)}}),pt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},gt=h("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 368L144 144"},null,-1),mt=h("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 144L144 368"},null,-1),ft=[gt,mt],ht=x({name:"CloseOutline",render:function(t,o){return _(),v("svg",pt,ft)}}),wt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},kt=h("path",{d:"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192s192-86 192-192z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),vt=h("path",{d:"M216.32 334.44l114.45-69.14a10.89 10.89 0 0 0 0-18.6l-114.45-69.14a10.78 10.78 0 0 0-16.32 9.31v138.26a10.78 10.78 0 0 0 16.32 9.31z",fill:"currentColor"},null,-1),xt=[kt,vt],yt=x({name:"PlayCircleOutline",render:function(t,o){return _(),v("svg",wt,xt)}}),St={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ct=h("path",{d:"M320 146s24.36-12-64-12a160 160 0 1 0 160 160",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32"},null,-1),$t=h("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 58l80 80l-80 80"},null,-1),bt=[Ct,$t],Mt=x({name:"RefreshOutline",render:function(t,o){return _(),v("svg",St,bt)}}),Tt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Lt=h("path",{d:"M400 148l-21.12-24.57A191.43 191.43 0 0 0 240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 0 0 181.07-128",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32"},null,-1),zt=h("path",{d:"M464 97.42V208a16 16 0 0 1-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z",fill:"currentColor"},null,-1),It=[Lt,zt],Rt=x({name:"ReloadOutline",render:function(t,o){return _(),v("svg",Tt,It)}}),jt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ot=h("path",{d:"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192s192-86 192-192z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),Bt=h("path",{d:"M310.4 336H201.6a25.62 25.62 0 0 1-25.6-25.6V201.6a25.62 25.62 0 0 1 25.6-25.6h108.8a25.62 25.62 0 0 1 25.6 25.6v108.8a25.62 25.62 0 0 1-25.6 25.6z",fill:"currentColor"},null,-1),Nt=[Ot,Bt],Dt=x({name:"StopCircleOutline",render:function(t,o){return _(),v("svg",jt,Nt)}}),At={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Pt=X('<path d="M112 112l20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M80 112h352" fill="currentColor"></path><path d="M192 112V72h0a23.93 23.93 0 0 1 24-24h80a23.93 23.93 0 0 1 24 24h0v40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 176v224"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M184 176l8 224"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M328 176l-8 224"></path>',6),Vt=[Pt],Et=x({name:"TrashOutline",render:function(t,o){return _(),v("svg",At,Vt)}});class Ht{constructor(){F(this,"client");this.client=ct.create({baseURL:"/datacenter",timeout:1e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.response.use(t=>t,t=>(console.error("API 请求失败:",t),Promise.reject(t)))}async getStatus(){const{data:t}=await this.client.get("/status");return t.data}async start(){const{data:t}=await this.client.post("/start");return t}async stop(){const{data:t}=await this.client.post("/stop");return t}async restart(){const{data:t}=await this.client.post("/restart");return t}async getLogs(t=100){const{data:o}=await this.client.get("/logs",{params:{limit:t}});return o.data}createLogStream(){return new EventSource("/datacenter/logs/stream")}}const D=new Ht,A=Z("datacenter",()=>{const a=O({status:"stopped",uptime_seconds:0,modules:{}}),t=O([]),o=O(!1),u=O(!0),p=z(()=>a.value.status==="running"),i=z(()=>a.value.status==="starting"),l=z(()=>a.value.status==="stopped"),y=z(()=>({stopped:"⚫ 未启动",starting:"🟡 启动中",running:"🟢 运行中",stopping:"🟠 停止中",error:"🔴 错误"})[a.value.status]||a.value.status),R=z(()=>{const s=a.value.uptime_seconds;if(!s)return"0秒";const d=Math.floor(s/86400),w=Math.floor(s%86400/3600),B=Math.floor(s%3600/60),N=s%60;let L="";return d>0&&(L+=`${d}天 `),w>0&&(L+=`${w}小时 `),B>0&&(L+=`${B}分 `),L+=`${N}秒`,L}),$=z(()=>a.value.start_time?new Date(a.value.start_time).toLocaleString("zh-CN"):"-");async function m(){try{const s=await D.getStatus();a.value=s}catch(s){console.error("获取状态失败:",s)}}async function k(){var s,d;o.value=!0;try{return await D.start(),await m(),{success:!0,message:"数据中心启动命令已发送"}}catch(w){return{success:!1,message:((d=(s=w.response)==null?void 0:s.data)==null?void 0:d.message)||"启动失败"}}finally{o.value=!1}}async function b(){var s,d;o.value=!0;try{return await D.stop(),await m(),{success:!0,message:"数据中心停止命令已发送"}}catch(w){return{success:!1,message:((d=(s=w.response)==null?void 0:s.data)==null?void 0:d.message)||"停止失败"}}finally{o.value=!1}}async function M(){var s,d;o.value=!0;try{return await D.restart(),await m(),{success:!0,message:"数据中心重启命令已发送"}}catch(w){return{success:!1,message:((d=(s=w.response)==null?void 0:s.data)==null?void 0:d.message)||"重启失败"}}finally{o.value=!1}}function T(s){t.value.push(s),t.value.length>500&&t.value.shift()}function S(){t.value=[]}function f(){u.value=!u.value}return{state:a,logs:t,loading:o,autoScroll:u,isRunning:p,isStarting:i,isStopped:l,statusText:y,uptimeText:R,startTimeText:$,fetchStatus:m,start:k,stop:b,restart:M,addLog:T,clearLogs:S,toggleAutoScroll:f}}),Ft=x({__name:"StatusCard",setup(a){const t=A(),{state:o,loading:u,isRunning:p,isStarting:i,statusText:l,uptimeText:y,startTimeText:R}=V(t),$=tt(),m=et(),k=z(()=>({stopped:"default",starting:"warning",running:"success",stopping:"warning",error:"error"})[o.value.status]||"default");async function b(){const f=await t.start();f.success?m.success(f.message):m.error(f.message)}async function M(){$.warning({title:"确认停止",content:"确定要停止数据中心吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{const f=await t.stop();f.success?m.success(f.message):m.error(f.message)}})}async function T(){$.warning({title:"确认重启",content:"确定要重启数据中心吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{const f=await t.restart();f.success?m.success(f.message):m.error(f.message)}})}function S(){t.fetchStatus(),m.success("状态已刷新")}return(f,s)=>{const d=r("n-text"),w=r("n-tag"),B=r("n-statistic"),N=r("n-card"),L=r("n-gi"),W=r("n-grid"),P=r("n-icon"),j=r("n-button"),E=r("n-space"),q=r("n-alert"),Y=r("n-divider");return _(),C(N,{title:"系统状态",hoverable:""},{default:e(()=>[n(E,{vertical:"",size:20},{default:e(()=>[h("div",null,[n(d,{strong:""},{default:e(()=>[...s[0]||(s[0]=[g("当前状态：",-1)])]),_:1}),n(w,{type:k.value,size:"large",round:"",strong:"",style:{"margin-left":"10px"}},{default:e(()=>[g(I(c(l)),1)]),_:1},8,["type"])]),n(W,{cols:2,"x-gap":15,"y-gap":15,responsive:"screen"},{default:e(()=>[n(L,null,{default:e(()=>[n(N,{size:"small",hoverable:""},{default:e(()=>[n(B,{label:"启动时间"},{default:e(()=>[n(d,{style:{"font-size":"16px"}},{default:e(()=>[g(I(c(R)),1)]),_:1})]),_:1})]),_:1})]),_:1}),n(L,null,{default:e(()=>[n(N,{size:"small",hoverable:""},{default:e(()=>[n(B,{label:"运行时长"},{default:e(()=>[n(d,{style:{"font-size":"16px"}},{default:e(()=>[g(I(c(y)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(E,{wrap:""},{default:e(()=>[n(j,{type:"success",loading:c(u),disabled:c(p)||c(i),onClick:b},{icon:e(()=>[n(P,null,{default:e(()=>[n(c(yt))]),_:1})]),default:e(()=>[s[1]||(s[1]=g(" 启动数据中心 ",-1))]),_:1},8,["loading","disabled"]),n(j,{type:"error",loading:c(u),disabled:!c(p),onClick:M},{icon:e(()=>[n(P,null,{default:e(()=>[n(c(Dt))]),_:1})]),default:e(()=>[s[2]||(s[2]=g(" 停止数据中心 ",-1))]),_:1},8,["loading","disabled"]),n(j,{type:"info",loading:c(u),onClick:T},{icon:e(()=>[n(P,null,{default:e(()=>[n(c(Mt))]),_:1})]),default:e(()=>[s[3]||(s[3]=g(" 重启数据中心 ",-1))]),_:1},8,["loading"]),n(j,{type:"default",onClick:S},{icon:e(()=>[n(P,null,{default:e(()=>[n(c(Rt))]),_:1})]),default:e(()=>[s[4]||(s[4]=g(" 刷新状态 ",-1))]),_:1})]),_:1}),c(o).error_message?(_(),C(q,{key:0,type:"error",title:`错误: ${c(o).error_message}`,closable:""},null,8,["title"])):nt("",!0),n(Y),n(E,null,{default:e(()=>[n(j,{text:"",tag:"a",href:"/docs",target:"_blank",type:"primary"},{default:e(()=>[...s[5]||(s[5]=[g(" 📖 API 文档 ",-1)])]),_:1}),n(j,{text:"",tag:"a",href:"/health",target:"_blank",type:"primary"},{default:e(()=>[...s[6]||(s[6]=[g(" ❤️ 健康检查 ",-1)])]),_:1}),n(j,{text:"",tag:"a",href:"/metrics/summary",target:"_blank",type:"primary"},{default:e(()=>[...s[7]||(s[7]=[g(" 📈 监控指标 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})}}}),Ut={class:"module-content"},Gt=x({__name:"ModulesCard",setup(a){const t=A(),{state:o}=V(t),u=z(()=>o.value.modules);function p(i){return{pending:"default",starting:"warning",running:"success",error:"error",registered:"info"}[i]||"default"}return(i,l)=>{const y=r("n-empty"),R=r("n-text"),$=r("n-tag"),m=r("n-list-item"),k=r("n-list"),b=r("n-scrollbar"),M=r("n-card");return _(),C(M,{title:"模块状态",hoverable:""},{default:e(()=>[n(b,{style:{"max-height":"400px"}},{default:e(()=>[Object.keys(u.value).length===0?(_(),C(y,{key:0,description:"暂无模块信息",style:{padding:"40px 0"}})):(_(),C(k,{key:1,bordered:""},{default:e(()=>[(_(!0),v(U,null,G(u.value,(T,S)=>(_(),C(m,{key:S,class:"module-item"},{default:e(()=>[h("div",Ut,[n(R,{strong:"",class:"module-name"},{default:e(()=>[g(I(S),1)]),_:2},1024),n($,{type:p(T.status),size:"small",round:"",strong:"",class:"module-status"},{default:e(()=>[g(I(T.status),1)]),_:2},1032,["type"])])]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})}}}),Jt=H(Gt,[["__scopeId","data-v-7eac3648"]]);function Wt(){const a=A(),t=O(null),o=O(!1);function u(){t.value&&t.value.close(),console.log("🔌 正在连接日志流..."),t.value=D.createLogStream(),t.value.onopen=()=>{console.log("✅ 日志流连接成功"),o.value=!0},t.value.addEventListener("log",i=>{console.log("📝 收到日志事件:",i.data);try{if(!i.data||i.data.trim()===""){console.warn("⚠️ 收到空日志数据");return}const l=JSON.parse(i.data);console.log("✅ 日志解析成功:",l),l&&typeof l=="object"?a.addLog(l):console.warn("⚠️ 日志对象格式无效:",l)}catch(l){console.error("❌ 日志解析失败:",l,"原始数据:",i.data)}}),t.value.addEventListener("ping",i=>{try{if(i.data){const l=JSON.parse(i.data);console.debug("💓 收到心跳:",l)}}catch(l){console.debug("⚠️ 心跳解析失败:",l)}}),t.value.onerror=i=>{console.error("❌ 日志流连接错误:",i),o.value=!1,console.log("🔄 将在5秒后重连..."),setTimeout(u,5e3)}}function p(){t.value&&(t.value.close(),t.value=null,o.value=!1,console.log("🔌 日志流已断开"))}return J(()=>{a.addLog({timestamp:new Date().toISOString(),level:"INFO",message:"Web控制面板已加载，等待连接数据中心..."}),u()}),st(()=>{p()}),{connected:o,connect:u,disconnect:p}}function qt(a){const t=new Date(a),o=t.getFullYear(),u=String(t.getMonth()+1).padStart(2,"0"),p=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0"),y=String(t.getSeconds()).padStart(2,"0");return`${o}-${u}-${p} ${i}:${l}:${y}`}const Yt=x({__name:"LogsCard",setup(a){const t=A(),o=ot(),{logs:u,autoScroll:p}=V(t),{isDark:i}=V(o),l=O(null);Wt(),at(()=>u.value.length,async()=>{p.value&&l.value&&(await lt(),l.value.scrollTop=l.value.scrollHeight)});function y(m){return{INFO:"info",WARNING:"warning",ERROR:"error",DEBUG:"default"}[m]||"default"}function R(){t.clearLogs()}function $(){t.toggleAutoScroll()}return(m,k)=>{const b=r("n-icon"),M=r("n-button"),T=r("n-space"),S=r("n-text"),f=r("n-tag"),s=r("n-card");return _(),C(s,{title:"实时日志",hoverable:""},{"header-extra":e(()=>[n(T,null,{default:e(()=>[n(M,{size:"small",onClick:R,disabled:c(u).length===0},{icon:e(()=>[n(b,null,{default:e(()=>[n(c(Et))]),_:1})]),default:e(()=>[k[0]||(k[0]=g(" 清空日志 ",-1))]),_:1},8,["disabled"]),n(M,{size:"small",type:c(p)?"primary":"default",onClick:$},{icon:e(()=>[n(b,null,{default:e(()=>[c(p)?(_(),C(c(_t),{key:0})):(_(),C(c(ht),{key:1}))]),_:1})]),default:e(()=>[k[1]||(k[1]=g(" 自动滚动 ",-1))]),_:1},8,["type"])]),_:1})]),default:e(()=>[h("div",{ref_key:"logsContainerRef",ref:l,class:rt(["logs-container",{"logs-container-dark":c(i)}])},[(_(!0),v(U,null,G(c(u),(d,w)=>(_(),v("div",{key:w,class:"log-entry"},[n(S,{depth:"3",class:"log-timestamp"},{default:e(()=>[g(I(c(qt)(d.timestamp)),1)]),_:2},1024),n(f,{type:y(d.level),size:"small",round:"",strong:"",class:"log-level"},{default:e(()=>[g(I(d.level),1)]),_:2},1032,["type"]),n(S,{class:"log-message"},{default:e(()=>[g(I(d.message),1)]),_:2},1024)]))),128))],2)]),_:1})}}}),Kt=H(Yt,[["__scopeId","data-v-6f3b9f1e"]]),Qt={class:"home-page"},Xt=x({__name:"HomePage",setup(a){const t=A();return J(()=>{t.fetchStatus(),setInterval(()=>{t.fetchStatus()},3e3)}),(o,u)=>{const p=r("n-gi"),i=r("n-grid");return _(),v("div",Qt,[n(i,{cols:2,"x-gap":20,"y-gap":20,responsive:"screen","collapsed-rows":1},{default:e(()=>[n(p,null,{default:e(()=>[n(Ft)]),_:1}),n(p,null,{default:e(()=>[n(Jt)]),_:1}),n(p,{span:2},{default:e(()=>[n(Kt)]),_:1})]),_:1})])}}}),ne=H(Xt,[["__scopeId","data-v-48822f08"]]);export{ne as default};
